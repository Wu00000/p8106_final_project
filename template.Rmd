---
title: "Simple document"
output: pdf_document
---

```{r}
library(tidyverse)
library(caret)
library(corrplot)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)
```

## Pre-process

```{r}
## Input
IBM_df = read.csv("IBM.csv") %>% 
  mutate(Education = recode(Education,
                            "1" = "Below College",
                            "2" = "College",
                            "3" = "Bachelor",
                            "4" = "Master",
                            "5" = "Doctor"),
         WorkLifeBalance = recode(WorkLifeBalance,
                                  "1" = "Bad",
                                  "2" = "Good",
                                  "3" = "Better",
                                  "4" = "Best"),
         EnvironmentSatisfaction = recode(EnvironmentSatisfaction,
                                          "1" = "Low",
                                          "2" = "Medium",
                                          "3" = "High",
                                          "4" = "Very High"),
         JobSatisfaction = recode(JobSatisfaction,
                                  "1" = "Low",
                                  "2" = "Medium",
                                  "3" = "High",
                                  "4" = "Very High"))

## Partition 
set.seed(2022)
trRow <- createDataPartition(IBM_df$Attrition, p = 0.8, list = F)

## Train data
IBM_train <- IBM_df[trRow, ]
x_train <- model.matrix(Attrition ~., IBM_train)[,-1]
y_train <- IBM_train$Attrition

## Test data
IBM_test <- IBM_df[-trRow, ]
x_test <- model.matrix(Attrition ~., IBM_test)[,-1]
y_test <- IBM_test$Attrition
```

## Exploratory

```{r, fig.height=8, fig.width=8}
corrplot(cor(x_train),
         method = "circle", 
         type = "upper", 
         tl.col = "black",
         tl.cex = 1.2,
         tl.srt = 70)

# Barplot matrix for categorical variables
IBM_train %>% 
  select(2, 3, 5:9, 12) %>% 
  pivot_longer(-1,
               names_to = "Variable",
               values_to = "Value") %>% 
  group_by(Variable, Value, Attrition) %>% 
  summarize(num = n()) %>% 
  ungroup() %>% 
  group_by(Variable, Attrition) %>% 
  mutate(percent = num / sum(num)) %>% 
  ggplot(aes(x = Value, y = percent, fill = Attrition)) +
  geom_col(position = "dodge") + 
  coord_flip() +
  facet_wrap(~ Variable, scales = "free") + theme_bw()
  
```

## glm 

```{r}

```

